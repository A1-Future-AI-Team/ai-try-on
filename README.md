# Virtual Try-On Studio

A full-stack AI-powered virtual try-on application that lets users upload their photo and clothing items to see realistic try-on results generated by Google Gemini AI. Built with React + TypeScript + MongoDB for a modern, secure, and scalable experience.

---

## 🚀 Features

- **AI-Powered Try-On:** Uses Google Gemini 2.0 Flash Exp for realistic image generation
- **Smart Progress Tracking:** Real-time progress indicators with time estimation during AI processing
- **Modern Frontend:** Beautiful React + TypeScript + Vite + Tailwind CSS interface
- **MongoDB Backend:** Secure, scalable TypeScript backend with comprehensive error handling
- **JWT Authentication:** Secure user registration, login, and session management
- **Image Management:** Upload, view, download, and delete try-on results with automatic cleanup
- **Session Persistence:** Robust authentication with smart retry logic and network error handling
- **Auto-Expire Results:** Try-on results automatically expire and are deleted after 24 hours
- **Real-time Notifications:** User feedback for success, errors, and expiration status

---

## 🛠️ Tech Stack

### Frontend
- **React 18** with TypeScript
- **Vite** for development and build
- **Tailwind CSS** for styling
- **JWT Authentication** with smart retry logic

### Backend
- **Node.js** with **Express** and **TypeScript**
- **MongoDB** with **Mongoose** ODM
- **JWT** authentication with bcrypt password hashing
- **Multer** for file uploads
- **Rate limiting** and **CORS** security
- **Node-cron** for automatic cleanup

### AI & Storage
- **Google Gemini 2.0 Flash Exp** API for image generation
- **Local file storage** with optional **Cloudinary** support
- **UUID-based** filename generation

---

## ⚡ Quick Start

### Prerequisites
- **Node.js v16+**
- **MongoDB** (local or Atlas)
- **Google AI API Key** ([Get one here](https://aistudio.google.com/))
- **Git**

### 1. Clone the Repository
```bash
git clone https://github.com/yourusername/virtual-try-on.git
cd virtual-try-on
```

### 2. Setup MongoDB

**Option A: MongoDB Atlas (Recommended)**
1. Create account at [MongoDB Atlas](https://www.mongodb.com/atlas)
2. Create a new cluster
3. Get connection string

**Option B: Local MongoDB**
```bash
# macOS
brew install mongodb-community

# Ubuntu
sudo apt install mongodb

# Docker
docker run -d -p 27017:27017 --name mongodb mongo:latest
```

### 3. Configure Backend Environment

```bash
cd mongo
cp env.example .env
```

Edit `mongo/.env` with your configuration:
```env
# Required Configuration
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/virtual-try-on
JWT_SECRET=your-super-secure-jwt-secret-key-here
GOOGLE_AI_API_KEY=your-google-ai-api-key-here
PORT=3002

# Optional Configuration
NODE_ENV=development
FRONTEND_URL=http://localhost:5173

# Optional: Cloudinary for cloud storage
CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret
```

### 4. Setup Frontend Environment

```bash
cd Frontend
```

Create `Frontend/.env`:
```env
VITE_MONGODB_API_URL=http://localhost:3002
```

### 5. Install Dependencies

```bash
# Backend dependencies
cd mongo
npm install

# Frontend dependencies
cd ../Frontend
npm install
```

### 6. Start the Application

**Terminal 1: Backend**
```bash
cd mongo
npm run dev
```

**Terminal 2: Frontend**
```bash
cd Frontend
npm run dev
```

Visit [http://localhost:5173](http://localhost:5173) to use the application.

---

## 📁 Project Structure

```
virtual-try-on/
├── mongo/                          # MongoDB Backend (TypeScript)
│   ├── src/
│   │   ├── config/                # Database configuration
│   │   ├── controllers/           # API controllers
│   │   ├── middleware/            # Auth, error handling, rate limiting
│   │   ├── models/                # MongoDB schemas (User, Image, TryOnSession)
│   │   ├── routes/                # API routes
│   │   ├── services/              # AI service integration
│   │   ├── types/                 # TypeScript type definitions
│   │   ├── utils/                 # Utilities (Cloudinary, etc.)
│   │   └── server.ts              # Main server file
│   ├── uploads/                   # Local file storage
│   ├── .env                       # Environment configuration
│   └── package.json
├── Frontend/                       # React Frontend (TypeScript)
│   ├── src/
│   │   ├── components/            # React components
│   │   ├── hooks/                 # Custom hooks (AuthContext, useAuth)
│   │   └── lib/                   # API configuration
│   ├── .env                       # Frontend environment
│   └── package.json
└── README.md                      # This file
```

---

## ✨ How to Use

1. **Register/Login:** Create an account or sign in with existing credentials
2. **Upload Images:** Upload your photo and select a clothing item
3. **AI Try-On:** Click "Generate Try-On" and watch the real-time progress
4. **View Results:** See your try-on result with download and delete options
5. **History:** Access your previous try-ons from the history page
6. **Auto-Cleanup:** Results automatically expire after 24 hours

---

## 🔧 API Endpoints

### Authentication
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `GET /api/auth/profile` - Get user profile (JWT required)

### Image Upload
- `POST /api/upload` - Upload images (person/garment)

### Try-On Sessions
- `POST /api/tryOn` - Create new try-on session
- `GET /api/tryOn/:sessionId` - Get session status/result
- `GET /api/tryOn` - Get user's try-on history
- `DELETE /api/tryOn/:sessionId` - Delete try-on session

---

## 🧹 Automatic Cleanup

The application includes automatic cleanup features:
- **Cron Job:** Runs every hour to delete expired sessions (24+ hours old)
- **File Cleanup:** Removes associated image files when sessions are deleted
- **UI Indicators:** Shows expiration time for each result

---

## 🐛 Troubleshooting

### Common Issues

**1. MongoDB Connection Error**
```bash
# Check MongoDB status
mongosh "your-mongodb-uri"

# For local MongoDB
sudo systemctl start mongod  # Linux
brew services start mongodb-community  # macOS
```

**2. "Cannot find module 'node-cron'"**
```bash
cd mongo
npm install node-cron @types/node-cron
```

**3. Authentication Issues**
- Verify `JWT_SECRET` is set in `mongo/.env`
- Check if JWT_SECRET is commented out (remove `#` if present)
- Ensure backend is running on correct port

**4. AI Generation Fails**
- Verify `GOOGLE_AI_API_KEY` is correct in `mongo/.env`
- Check Google AI Studio quota and usage
- Review backend logs for AI service errors

**5. Frontend Login Issues**
- Check `VITE_MONGODB_API_URL` in `Frontend/.env`
- Verify backend is accessible from frontend
- Check browser console for network errors

### Enable Debug Logging

```bash
# In mongo/.env
NODE_ENV=development
DEBUG=app:*
```

---

## 🚀 Production Deployment

### Backend (Node.js)
```bash
cd mongo
npm run build
npm start
```

### Frontend (Static Files)
```bash
cd Frontend
npm run build
# Deploy dist/ folder to your hosting service
```

### Environment Variables for Production
- Set `NODE_ENV=production`
- Use strong `JWT_SECRET`
- Configure proper `MONGODB_URI`
- Set correct `FRONTEND_URL`

---

## 🧑‍💻 Development

### Backend Commands
```bash
cd mongo
npm run dev          # Start with hot reload
npm run build        # Build TypeScript
npm start           # Start production server
npm run lint        # Run ESLint
```

### Frontend Commands
```bash
cd Frontend
npm run dev         # Start development server
npm run build       # Build for production
npm run preview     # Preview production build
```

### Testing
```bash
# Backend API testing
cd mongo
node test-backend.js
```

---

## 📄 License

MIT License - feel free to use this project for learning or commercial purposes.

---

## 🙏 Credits

- [Google Gemini API](https://aistudio.google.com/) - AI image generation
- [MongoDB Atlas](https://www.mongodb.com/atlas) - Database hosting
- [React](https://react.dev/) - Frontend framework
- [Tailwind CSS](https://tailwindcss.com/) - CSS framework
- [Vite](https://vitejs.dev/) - Build tool

---

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

---

**⭐ Star this repo if you find it helpful!**
